{% extends "base.html" %}

{% block title %}TÃ­nh lÆ°Æ¡ng - Há»‡ thá»‘ng quáº£n lÃ½ váº­n chuyá»ƒn{% endblock %}

{% block content %}
<h2>ğŸ’° TÃ­nh lÆ°Æ¡ng nhÃ¢n viÃªn</h2>

<div style="background: rgba(231, 76, 60, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
    <h3 style="color: #e74c3c; margin-bottom: 15px;">ğŸ“… Chá»n thÃ¡ng tÃ­nh lÆ°Æ¡ng</h3>
    <form method="get" action="/salary" style="display: flex; gap: 20px; align-items: end; flex-wrap: wrap;">
        <div class="form-group" style="margin-bottom: 0;">
            <label for="month">ThÃ¡ng</label>
            <select id="month" name="month" style="width: auto; min-width: 120px;">
                {% for i in range(1, 13) %}
                <option value="{{ i }}" {% if i == month %}selected{% endif %}>ThÃ¡ng {{ i }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label for="year">NÄƒm</label>
            <select id="year" name="year" style="width: auto; min-width: 120px;">
                {% for i in range(2020, 2030) %}
                <option value="{{ i }}" {% if i == year %}selected{% endif %}>{{ i }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn">Xem báº£ng lÆ°Æ¡ng</button>
    </form>
</div>

<h3>ğŸ“Š Báº£ng lÆ°Æ¡ng thÃ¡ng {{ month }}/{{ year }}</h3>
{% if salary_data %}
<table class="table">
    <thead>
        <tr>
            <th>STT</th>
            <th>Há» tÃªn</th>
            <th>LÆ°Æ¡ng cÆ¡ báº£n</th>
            <th>Sá»‘ chuyáº¿n</th>
            <th>Tá»•ng lÆ°Æ¡ng chuyáº¿n</th>
            <th>Tá»•ng chi phÃ­ xÄƒng</th>
            <th>Tá»•ng lÆ°Æ¡ng</th>
        </tr>
    </thead>
    <tbody>
        {% for data in salary_data %}
        <tr>
            <td>{{ loop.index }}</td>
            <td><strong>{{ data.employee.name }}</strong></td>
            <td>{{ "{:,.0f}".format(data.base_salary) }} VNÄ</td>
            <td>
                <span style="background: rgba(52, 152, 219, 0.1); color: #3498db; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                    {{ data.trip_count }} chuyáº¿n
                </span>
            </td>
            <td>{{ "{:,.0f}".format(data.total_trip_salary) }} VNÄ</td>
            <td>{{ "{:,.0f}".format(data.total_fuel_cost) }} VNÄ</td>
            <td>
                <strong style="color: #27ae60; font-size: 1.1em;">
                    {{ "{:,.0f}".format(data.total_salary) }} VNÄ
                </strong>
            </td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot style="background: rgba(52, 73, 94, 0.1); font-weight: bold;">
        <tr>
            <td colspan="2"><strong>Tá»”NG Cá»˜NG</strong></td>
            <td><strong>{{ "{:,.0f}".format(salary_data|sum(attribute='base_salary')) }} VNÄ</strong></td>
            <td><strong>{{ salary_data|sum(attribute='trip_count') }} chuyáº¿n</strong></td>
            <td><strong>{{ "{:,.0f}".format(salary_data|sum(attribute='total_trip_salary')) }} VNÄ</strong></td>
            <td><strong>{{ "{:,.0f}".format(salary_data|sum(attribute='total_fuel_cost')) }} VNÄ</strong></td>
            <td><strong style="color: #e74c3c; font-size: 1.2em;">{{ "{:,.0f}".format(salary_data|sum(attribute='total_salary')) }} VNÄ</strong></td>
        </tr>
    </tfoot>
</table>

<!-- Chi tiáº¿t tá»«ng nhÃ¢n viÃªn -->
<div style="margin-top: 30px;">
    <h3>ğŸ“‹ Chi tiáº¿t tá»«ng nhÃ¢n viÃªn</h3>
    {% for data in salary_data %}
    {% if data.trip_count > 0 %}
    <div style="background: rgba(255, 255, 255, 0.8); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #3498db;">
        <h4 style="color: #2c3e50; margin-bottom: 15px;">ğŸ‘¤ {{ data.employee.name }}</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <strong>LÆ°Æ¡ng cÆ¡ báº£n:</strong><br>
                <span style="color: #3498db;">{{ "{:,.0f}".format(data.base_salary) }} VNÄ</span>
            </div>
            <div>
                <strong>Sá»‘ chuyáº¿n:</strong><br>
                <span style="color: #f39c12;">{{ data.trip_count }} chuyáº¿n</span>
            </div>
            <div>
                <strong>Tá»•ng lÆ°Æ¡ng chuyáº¿n:</strong><br>
                <span style="color: #27ae60;">{{ "{:,.0f}".format(data.total_trip_salary) }} VNÄ</span>
            </div>
            <div>
                <strong>Tá»•ng chi phÃ­ xÄƒng:</strong><br>
                <span style="color: #e67e22;">{{ "{:,.0f}".format(data.total_fuel_cost) }} VNÄ</span>
            </div>
            <div>
                <strong>Tá»•ng lÆ°Æ¡ng:</strong><br>
                <span style="color: #e74c3c; font-size: 1.1em; font-weight: bold;">{{ "{:,.0f}".format(data.total_salary) }} VNÄ</span>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>

<!-- Thá»‘ng kÃª tá»•ng quan -->
<div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white;">
    <h3 style="margin-bottom: 20px;">ğŸ“Š Thá»‘ng kÃª tá»•ng quan thÃ¡ng {{ month }}/{{ year }}</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        <div style="text-align: center;">
            <h4 style="font-size: 2em; margin-bottom: 5px;">{{ salary_data|length }}</h4>
            <p>NhÃ¢n viÃªn</p>
        </div>
        <div style="text-align: center;">
            <h4 style="font-size: 2em; margin-bottom: 5px;">{{ salary_data|sum(attribute='trip_count') }}</h4>
            <p>Tá»•ng chuyáº¿n</p>
        </div>
        <div style="text-align: center;">
            <h4 style="font-size: 2em; margin-bottom: 5px;">{{ "{:,.0f}".format(salary_data|sum(attribute='total_fuel_cost')) }}</h4>
            <p>Chi phÃ­ xÄƒng (VNÄ)</p>
        </div>
        <div style="text-align: center;">
            <h4 style="font-size: 2em; margin-bottom: 5px;">{{ "{:,.0f}".format(salary_data|sum(attribute='total_salary')) }}</h4>
            <p>Tá»•ng lÆ°Æ¡ng (VNÄ)</p>
        </div>
    </div>
</div>

{% else %}
<div style="text-align: center; padding: 40px; color: #7f8c8d;">
    <h3>ğŸ“… ChÆ°a cÃ³ dá»¯ liá»‡u lÆ°Æ¡ng thÃ¡ng {{ month }}/{{ year }}</h3>
    <p>CÃ³ thá»ƒ chÆ°a cÃ³ chuyáº¿n nÃ o Ä‘Æ°á»£c ghi nháº­n trong thÃ¡ng nÃ y</p>
    <div style="margin-top: 20px;">
        <a href="/daily" class="btn">Ghi nháº­n chuyáº¿n</a>
        <a href="/employees" class="btn" style="margin-left: 10px;">ThÃªm nhÃ¢n viÃªn</a>
    </div>
</div>
{% endif %}

<div style="margin-top: 30px; padding: 20px; background: rgba(241, 196, 15, 0.1); border-radius: 10px; border-left: 4px solid #f1c40f;">
    <h4 style="color: #f39c12; margin-bottom: 10px;">ğŸ’¡ CÃ´ng thá»©c tÃ­nh lÆ°Æ¡ng:</h4>
    <div style="color: #2c3e50; line-height: 1.6;">
        <p><strong>Tá»•ng lÆ°Æ¡ng = LÆ°Æ¡ng cÆ¡ báº£n + Tá»•ng lÆ°Æ¡ng chuyáº¿n</strong></p>
        <ul style="margin-top: 10px;">
            <li><strong>LÆ°Æ¡ng cÆ¡ báº£n:</strong> Má»©c lÆ°Æ¡ng cá»‘ Ä‘á»‹nh hÃ ng thÃ¡ng cá»§a nhÃ¢n viÃªn</li>
            <li><strong>LÆ°Æ¡ng chuyáº¿n:</strong> Tiá»n thÆ°á»Ÿng cho má»—i chuyáº¿n hoÃ n thÃ nh</li>
            <li><strong>Chi phÃ­ xÄƒng:</strong> Tá»•ng chi phÃ­ nhiÃªn liá»‡u (khÃ´ng trá»« vÃ o lÆ°Æ¡ng)</li>
        </ul>
    </div>
</div>
{% endblock %}
